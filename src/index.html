<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0" />
<title>CSS to XPath Converter</title>
<link href="main.css" rel="stylesheet">
<script src="main.js"></script>
</head>

<body>
<main>
<div class="buttons"><div id="up-btn" class="up-btn"></div><div id="down-btn" class="down-btn"></div></div>
<article id="article">
	<div class="links right">
		<a href="../index.html">Docs</a>
		<a href="https://github.com/angezid/FastHtml">GitHub</a>
	</div>
	<h1>CSS <span>to</span> XPath</h1>

	<div id="demo">
		<button id="convert">convert</button>
		<button id="clear">X</button>
		<select id="axes">
			<option value=".//" title="Select descendants of context node (the same as descendant::)">.//</option>
			<option value="//" title="Select descendants of the document" selected>//</option>
			<option value="descendant::">descendant::</option>
			<option value="descendant-or-self::">descendant-or-self::</option>
			<option value="ancestor::">ancestor::</option>
			<option value="ancestor-or-self::">ancestor-or-self::</option>
			<option value="self::">self::</option>
			<option value="parent::">parent::</option>
			<option value="child::" title="Select childs of context node (can be removed from beginning of XPath)">child::</option>
			<option value="preceding::">preceding::</option>
			<option value="preceding-sibling::">preceding-sibling::</option>
			<option value="following::">following::</option>
			<option value="following-sibling::">following-sibling::</option>
		</select>

		<input type="checkbox" id="fastHtmlLibrary" name="library" checked title="FastHtml library has internal `className` spaces normalization">
		<label id="library" for="library" title="FastHtml library has internal `className` spaces normalization">FastHtml library</label>

		<textarea id="input-box" type="text" placeholder="CSS Selector" autofocus="true" spellcheck="false" ></textarea>

		<div class="letters">
			<details><summary>Letters editor</summary>
				<div>
					<textarea id="uppercase" type="text" placeholder="Uppercase" autofocus="" spellcheck="false" ></textarea>
					<button id="to-lowercase">To lowercase</button>
				</div>
				<div>
					<textarea id="lowercase" type="text" placeholder="Lowercase" autofocus="" spellcheck="false" ></textarea>
					<button id="to-uppercase">To uppercase</button>
				</div>
			</details>
		</div>

		<pre id="result-box"></pre>
		<!-- <pre id="errors"></pre> -->
	</div>

	<div id="example-section">
		<h2>Examples</h2>
		<div id="example">
		</div>
	</div>
</article>

<footer><div class="info">
<span>FastHtml CSStoXPathConverter</span>
</div></footer>

<script>
	let prevPos = -1, lock = false;

	const input = document.getElementById('input-box'),
		body = document.getElementsByTagName('body')[0],
		up = document.getElementById('up-btn'),
		down = document.getElementById('down-btn'),

		lowercase = document.getElementById('lowercase'),
		toLowercase = document.getElementById('to-lowercase'),
		uppercase = document.getElementById('uppercase'),
		toUppercase = document.getElementById('to-uppercase'),

		axesSelector = document.getElementById('axes'),
		results = document.getElementById('result-box'),
		convertButton = document.getElementById('convert'),
		library = document.getElementById('library'),
		fastHtmlLibrary = document.getElementById('fastHtmlLibrary'),
		clearButton = document.getElementById('clear');

	input.addEventListener('paste', function(e) {
		setTimeout(function() {
			convert();
		}, 100);
	});

	fastHtmlLibrary.addEventListener('click', function() {
		setExamples();
		convert();
	});

	library.addEventListener('click', function() {
		fastHtmlLibrary.checked = !fastHtmlLibrary.checked;
		setExamples();
		convert();
	});

	axesSelector.addEventListener('change', function(e) {
		convert();
	});

	toLowercase.addEventListener('click', function() {
		const value = uppercase.value.trim();
		if (value) {
			console.log(value  );
			lowercase.value = value.toLowerCase();
		}
	});

	toUppercase.addEventListener('click', function() {
		const value = lowercase.value.trim();
		if (value) {
			uppercase.value = value.toUpperCase();
		}
	});

	window.addEventListener('scroll', function() {
		if ( !lock) {
			prevPos = getPositionY();
		}
	});

	up.addEventListener('click', function() {
		const currentPos = getPositionY();
		if (prevPos != -1 && currentPos >= prevPos) {
			scrollToPos(prevPos);
			prevPos += 60;

		} else {
			prevPos = currentPos;
			scrollToPos(0);
		}
		console.log('up', currentPos,  prevPos);
	});

	down.addEventListener('click', function() {
		const currentPos = getPositionY();
		if (currentPos >= prevPos) {
			scrollToPos(5000);

		} else {
			scrollToPos(prevPos);
		}
		console.log('down',currentPos,  prevPos);
	});

	function scrollToPos(pos) {
		lock = true;
		window.scrollTo(0, pos);
		setTimeout(function() { lock = false;	}, 100);
	}

	function getPositionY() {
		const top = window.pageYOffset;
		const elems = document.getElementsByTagName('tr');

		for(let i = 0; i < elems.length; i++) {
			if(elems[i].offsetTop >= top) {
				return elems[i].offsetTop;
			}
		}
		return elems[elems.length-1].offsetTop;
	}

	/*function getPositionY() {
		const half = window.innerHeight / 2;
		const top = window.pageYOffset + half;
		const elems = document.getElementsByTagName('tr');

		for(let i = 0; i < elems.length; i++) {
			if(elems[i].offsetTop + half >= top) {
				return elems[i].offsetTop + half;
			}
		}
		return -1;
	}*/

	function getPositionY2() {
		//const top = window.pageYOffset;
		const top = window.pageYOffset + window.innerHeight / 2;
		const elems = document.getElementsByTagName('tr');

		for(let i = 0; i < elems.length; i++) {
			if(elems[i].offsetTop >= top) {
				return elems[i].offsetTop;
			}
		}
		return -1;
	}

	convertButton.addEventListener('click', function() {
		convert();
	});

	clearButton.addEventListener('click', function() {
		input.value = '';
		results.innerHTML = '';
		input.focus();
	});

	function convert() {
		const selector = input.value.trim();
		if ( !selector) return;

		results.innerHTML = '';

		let axes = axesSelector.value;
		results.innerHTML = convertToXPath(selector, axes);
	}
</script>

<script>
	const selectors = [
		["$$Combinators", ""],
		["ul > li", "child"],
		["li !> ul", "parent"],
		["div + p", "adjacent following sibling"],
		["div !+ p", "adjacent preceding sibling"],
		["div ^ p", "first child"],
		["div !^ p", "last child"],
		["div ~ p", "following sibling"],
		["div !~ p", "preceding sibling"],
		["div ! p", "ancestors"],

		["$$Class attribute", ""],
		["div.content", "contains class"],
		["div[class='content']", "contains exactly"],
		["div[class='content' i]", "ignore case"],
		["div[class^='cont']", "starts with"],
		["div[class$='tent']", "ends with"],
		["div[class~='content']", "contains exactly"],
		["div[class*='ten']", "contains within"],
		["div[class|='content']", "exactly or followed by a hyphen"],

		["$$Attributes", ""],
		["ul>li[title^='Item']", ""],
		["ul>li[title$='One']", ""],
		["ul>li[title*='Item']", ""],
		["body[lang|=EN]", ""],
		["a[xlink|href]", "select attribute with namespace"],

		["$$Attributes ignore case", "https://developer.mozilla.org/en-US/docs/Web/CSS/Attribute_selectors"],
		["ul>li[title='one' i]", ""],
		["ul>li[title^='item' i]", ""],
		["ul>li[title$='one' i]", ""],
		["ul>li[title~='two' i]", ""],
		["ul>li[title*='twenty' i]", ""],
		["body[lang|=En i]", ""],

		["$$Pseudo-classes", ""],
		["li:not(.c1, .c2)", ""],
		["div:has(h1, h2)", ""],
		["div:has-sibling(p)", ""],
		["div:has-parent(main)", ""],
		["div:has-ancestor(main)", ""],
		["ul>li:range(2, 5)", ""],
		["div:contains('Test')", ""],
		["div:icontains('content')", ""],
		["div:starts-with(Test)", ""],
		["div:istarts-with('TEST')", ""],
		["p:ends-with('test')", ""],
		["p:iends-with('TEST')", ""],
		["div:empty", ""],
		["ul>li:first", ""],
		["ul>li:last", ""],
		["div:first-child", ""],
		["div:last-child", ""],
		["div>*:only-child", ""],
		["ul>li:gt(4)", ""],
		["ul>li:lt(4)", ""],
		["ul>li:eq(4)", ""],
		["ul>li:skip(4)", ""],
		["ul>li:skip-first", ""],
		["ul>li:skip-last", ""],
		["ul>li:limit(5)", ""],
		["ul>li:take(4)", ""],
		[":root", ""],

		["$$Pseudo-classes 'nth'", ""],
		["li:nth(5)", ""],
		["ul li:nth-child(3)", ""],
		["ul li:nth-child(even)", ""],
		["ul li:nth-child(odd)", ""],
		["ul li:nth-child(3n+2)", ""],

		["$$Pseudo-classes 'of-type'", ""],
		["div p:first-of-type", ""],
		["div>em:last-of-type", ""],
		["div p:only-of-type", ""],
		["ul li:nth-of-type(3)", ""],
		["ul li:nth-of-type(even)", ""],
		["ul li:nth-of-type(odd)", ""],
		["ul li:nth-of-type(3n+2)", ""],
		["ul li:nth-of-type(-3n+2)", ""],
		["ul li:nth-of-type(2n-1)", ""],

		["$$Spaces, comments", ""],
		["ul   >   li:  not (  .c1  )", ""],
		["li:  nth-child  (  -3n  +  4  )   ", ""],
		[`!> ul:first /*direct parent*/
		!^   li      /*last child*/
		!+   li  /*previous siblings*/`, ""],
	];

	setExamples();
	convert();

	function setExamples() {
		const section = document.getElementById('example');
		const sb = [];
		sb.push('<table><thead><tr><td>name</td><td>CSS</td><td>XPath</td></tr></thead><tbody>');

		selectors.forEach(item => {
			if (/^\$\$/.test(item[0])) {
				const title = item[0].substring(2);
				sb.push('<tr><td id="' + (title.replace(/\W+/g, '_').toLowerCase()) + '" class="group-name">' + title + '</td><td></td><td></td></tr>');

			} else {
				try {
					const xpath = convertToXPath(item[0], '//').replace(/ABCDEFGHJIKLMNOPQRSTUVWXYZ[^']*/g, 'ABC...').replace(/abcdefghjiklmnopqrstuvwxyz[^']*/g, 'abc...');
					sb.push('<tr><td class="name">' + (item[1] || ' - ') + '</td>');
					sb.push('<td class="css"><code class="css">' + item[0].replace(/ /g, '&nbsp;') + '</code></td><td><code class="xpath">' + xpath + '</code></td></tr>');

				} catch (e) {
					console.log(item[0], e);
				}
			}
		});
		sb.push('</tbody></table>');
		section.innerHTML = sb.join('');

		/*const codes = document.getElementsByClassName('xpath');

		for(let i = 0; i < codes.length; i++) {
			hljs.highlightElement(codes[i]);
		}*/
	}
</script>

</body>
</html>